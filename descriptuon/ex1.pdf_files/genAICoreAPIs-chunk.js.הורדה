"use strict";(self["webpackJsonp-genai"]=self["webpackJsonp-genai"]||[]).push([[1431],{ZnEp:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_});var i=n("plsW"),o=n("835Y"),s=n.n(o),__awaiter=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?o(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};const createReadableStream=()=>{let e;return{chunkListener:t=>{var n;try{e.enqueue(t),"Completed"===(null===(n=null==t?void 0:t.end_of_stream)||void 0===n?void 0:n.status)&&e.close()}catch(t){e.error(t)}},onError:t=>{e.error(t)},response:new ReadableStream({start(t){return __awaiter(this,void 0,void 0,(function*(){try{e=t}catch(t){e.error(t)}}))}})}},evaluateCurrentFeatureLimits=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{feature_limits:n,scan_feature_limits:i}=e;let o=null==n?void 0:n.max_page_count,s=null==n?void 0:n.supported_doc_languages;return!0===t&&(o=null==i?void 0:i.max_page_count,s=null==i?void 0:i.supported_doc_languages),{maxPageCount:o,maxFileSize:null==n?void 0:n.max_file_size,maxFileSizeInMb:Math.floor((null==n?void 0:n.max_file_size)/1024),maxFileSizeInBytes:1024*(null==n?void 0:n.max_file_size),allowScannedPDFs:null==n?void 0:n.allow_scanned_pdfs_enabled,supportedDocLanguages:s}};var r=n("t3LK"),a=n("IX+m"),l=n("5a88"),c=n("VT2X"),d=n("DlMc"),u=n.n(d),m=n("Uohe"),f=n("gmFL"),h=n("QPTb"),v=n("jHMz"),g=n("tr63");class CancellableStreamRequestHandler{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3?arguments[3]:void 0;this.makePOSTRequest=e=>{let{featureName:t,assetId:n,pdfBuffer:i,clientAnalyticsConsent:o,documentMetadata:s,extraParams:r={}}=e;const a=this.abortController.signal;a.addEventListener("abort",this._abortHandler,{once:!0});const l=new Blob([i],{type:"application/pdf"});return new Promise((async(e,i)=>{(0,f.ow)(this.config,a,m.Xw.getClientID(),m.Xw.getAccessTokenInfo({isGuestAllowed:!0}).access_token,t,r,n,l,o,this.transactionId,s).then((t=>{e(t)})).catch((e=>{i(e)}))}))},this.makeStreamGETRequest=(e,t)=>{let n=this.abortController.signal;return t&&(n=AbortSignal.timeout(t)),n.addEventListener("abort",this._abortHandler,{once:!0}),new Promise((async(i,o)=>{(0,f.vp)(n,`${e}?outputName=outline_out&nonMultipart=true`,m.Xw.getClientID(),this.transactionId,m.Xw.getAccessTokenInfo({isGuestAllowed:!0}).access_token,t,this.zipStreamParser,this.ndJsonStreamParser,this.contentAnalyzerResponseParser,this.config).then((()=>{n.removeEventListener("abort",this._abortHandler,{once:!0}),i()})).catch((e=>{o(e)}))}))},this.makeContentAnalyzerResponseGETRequest=e=>{const t=this.abortController.signal;return t.addEventListener("abort",this._abortHandler,{once:!0}),new Promise((async(n,i)=>{(0,f.vf)(t,`${e}?outputName=outline_out&nonMultipart=true`,m.Xw.getClientID(),this.transactionId,m.Xw.getAccessTokenInfo({isGuestAllowed:!0}).access_token,this.config).then((e=>{t.removeEventListener("abort",this._abortHandler,{once:!0}),n(e)})).catch((e=>{i(e)}))}))},this.endStream=()=>{var e;null===(e=this.zipStreamParser)||void 0===e||e.destroyStream()},this.fetchSessionInfo=async(e,t)=>{const n=this.abortController.signal;n.addEventListener("abort",this._abortHandler,{once:!0});const{sessionInfoKey:i}=(0,h.lK)();return(0,f.Zh)(n,e,m.Xw.getClientID(),this.transactionId,m.Xw.getAccessTokenInfo({isGuestAllowed:!0}).access_token,i,t,this.config)},this.fetchDocumentInfo=async(e,t)=>{const n=this.abortController.signal;return n.addEventListener("abort",this._abortHandler,{once:!0}),(0,f.Zh)(n,e,m.Xw.getClientID(),this.transactionId,m.Xw.getAccessTokenInfo({isGuestAllowed:!0}).access_token,v.f,t,this.config)},this.cancelRequest=()=>{try{this.abortController.abort()}catch(e){this.cancellableStreamRequestLogger.error("Error during abort: ",e)}},this.zipStreamParser=e,this.ndJsonStreamParser=t,this.contentAnalyzerResponseParser=n,this.config=o,this.abortController=new(s()),this._abortHandler=this._abortHandler.bind(this),this.transactionId=u().v4(),this.cancellableStreamRequestLogger=i.logging.getLogger("CancellableStreamRequestHandler")}_abortHandler(){var e;null===(e=this.zipStreamParser)||void 0===e||e.destroyStream()}}var p=n("C444"),P=n("PX0L");function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return(t=function _toPropertyKey(e){var t=function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class GenAIOutlineController{constructor(e){let{config:t,outlineListener:n,requestInfoPromise:i,sessionInfoPromise:o,skipStreamParsing:s,documentInfoPromise:r}=e;this.makeStreamGETRequest=(e,t,n)=>this.streamRequestHandler.makeStreamGETRequest(e,t,n).then((()=>this.streamRequestHandler.makeContentAnalyzerResponseGETRequest(e).then((i=>this.contentAnalyzerResponseParser(i,e,n,t))))),this.contentAnalyzerResponseParser=async(e,t,n,i)=>{var o;if(this.endOfStreamReceived)return;const{status:s,report:r}=null==e||null===(o=e.statuses[0])||void 0===o?void 0:o.invocations[0];if("200"!==s){if(this.retryCount<n&&"202"===s)return this.retryCount+=1,this.makeStreamGETRequest(t,i,n);{const e=JSON.parse(r),t=e&&e.error_code||l.OQ.UNKNOWN;throw new Error(t)}}this.ndJsonStreamParser.flush(),this.endOfStreamReceived?this.streamRequestHandler.endStream():(await this.makeStreamGETRequest(t,l.E8,n),this.ndJsonStreamParser.flush())},this.fetchOutlineUnzippedStream=(e,t,n,i,o,s)=>{const{assetId:r,assetName:a,usePdfBuffer:c}=e||{},d={doc_id:r,filename:a},notifyErrorToClient=e=>{!this.skipStreamParsing&&this.outlineListener(l.kF.SENSEI_ERROR,e),this.abortOutlineResponse()};this.streamRequestHandler.makePOSTRequest({featureName:"outline",assetId:c?"":r,pdfBuffer:t,clientAnalyticsConsent:n,documentMetadata:i,extraParams:d}).then((async e=>{let{resourceUrl:t,serviceEngine:n,postRequestId:i,transactionId:o,locationHeaderValue:r,outputFormatSchema:a}=e;!this.skipStreamParsing&&this.outlineListener(l.kF.SENSEI_META_DATA,{post_request_id:i,transaction_id:o,serviceEngine:n,resourceUrl:t,locationHeaderValue:r,outputFormatSchema:a}),this.requestInfoPromise.resolve({postRequestId:i,transactionId:o,serviceEngine:n,resourceUrl:t,locationHeaderValue:r,outputFormatSchema:a});const c=this.makeStreamGETRequest(r,void 0,s).catch((e=>{notifyErrorToClient(e),this.requestInfoPromise.reject(e)})),d=await this.streamRequestHandler.fetchDocumentInfo(r,s).then((e=>{this.skipStreamParsing?this.documentInfoPromise.resolve(e):this.outlineListener(l.kF.DOC_CLASSIFIER,e)})).catch((e=>{notifyErrorToClient(e),this.documentInfoPromise.reject(e)})),u=await this.streamRequestHandler.fetchSessionInfo(r,s).then((e=>{this.skipStreamParsing?this.sessionInfoPromise.resolve(e):this.outlineListener(l.kF.SENSEI_SESSION_INFO,e)})).catch((e=>{notifyErrorToClient(e),this.sessionInfoPromise.reject(e)}));Promise.allSettled([c,d,u]).then((()=>{this.abortOutlineResponse()}))})).catch((e=>{notifyErrorToClient(e),this.requestInfoPromise.resolve({postRequestId:"",transactionId:""})}))},this.abortOutlineResponse=()=>{this.outlineListener=()=>{},this.streamRequestHandler.cancelRequest(),this.retryCount=l.fZ,this.aborted=!0},this.getStreamResponseHandler=()=>{const e=new Array(1e4),t=new Map;let n="NOT_LOADED",i=null;return function(){var o,s,r,a;const l=arguments.length<=0?void 0:arguments[0],c=arguments.length<=1?void 0:arguments[1],d={dataParts:[],sources:[]};if((null===(o=l.doc_summary)||void 0===o?void 0:o.dataParts)||(null===(s=l.overview)||void 0===s?void 0:s.dataParts)){var u,m;const e=(null===(u=l.doc_summary)||void 0===u?void 0:u.dataParts)||(null===(m=l.overview)||void 0===m?void 0:m.dataParts),t=Object.entries(e);d.dataParts=t.map((e=>{let[t,n]=e;return n.parts.map((e=>_objectSpread(_objectSpread({},e),{},{dataId:t})))})).flat();const n=Object.values(e);d.sources=n.flatMap((e=>e.sources)),d.isStreaming=!((null==l?void 0:l.overview)||(null==l?void 0:l.doc_summary)).isFinal,d.type=l.doc_summary?"doc_summary":"doc_overview",delete l.doc_summary,i={response:d}}(null===(r=l.heading)||void 0===r?void 0:r.dataParts)&&(Object.keys(l.heading.dataParts).forEach((n=>{var i;const o=null===(i=l.heading.dataParts[n].parts)||void 0===i?void 0:i[0];o&&Number.isInteger(o.heading_index)&&o.heading_index>=0&&o.heading_index<1e4&&(e[o.heading_index]=o,t.set(n,o.heading_index))})),delete l.heading),(null===(a=l.summary)||void 0===a?void 0:a.dataParts)&&(Object.keys(l.summary.dataParts).forEach((n=>{var i;const o=null===(i=l.summary.dataParts[n].parts)||void 0===i?void 0:i[0];if(o){const i=t.get(n);null!==i&&(e[i]=_objectSpread(_objectSpread({},e[i]),{},{summary:o.text,error:o.error,data_id:n,summary_num_deltas:o.num_deltas,summary_part_id:o.part_id}))}})),delete l.summary),l&&"COMPLETED"===l.status&&(n="LOADED"),c.outlineDataArray=e,c.overviewResponse=d,c.loadStatus=n}},this.outlineListener=n,this.outlineRegEx="",this.ndJsonStreamParser=new P.Y(this.ndJsonListener.bind(this),(()=>this.aborted)),this.zipStreamParser=new a.A(this.outlineZipListenerCallback.bind(this)),this.streamRequestHandler=new CancellableStreamRequestHandler(this.zipStreamParser,this.ndJsonStreamParser,this.contentAnalyzerResponseParser,t),this.failedParsedFilesData=new Map,this.jsonRegex=new RegExp(".json$"),this.retryCount=0,this.endOfStreamReceived=!1,this.skipStreamParsing=s,this.streamResponseObject=new p.b(s?()=>{}:e=>this.outlineListener(l.kF.DATA,e)),this.aborted=!1,this.getStreamResponseHandler=this.getStreamResponseHandler.bind(this),this.requestInfoPromise=i||(0,f.YP)(),this.sessionInfoPromise=o||(0,f.YP)(),this.documentInfoPromise=r||(0,f.YP)()}outlineZipListenerCallback(e,t){if(e===c.A.DATA){const e=t.fileName,n=t.data;let i,o;if(e.match(this.jsonRegex))try{o=this.failedParsedFilesData.get(e)?this.failedParsedFilesData.get(e)+n:n,i=JSON.parse(o)}catch(t){return void this.failedParsedFilesData.set(e,o)}"manifest.json"===e?this.outlineRegEx=new RegExp(`^${i.update_prefix}-\\d+\\.json$`):"info/session_info.csv"===e?!this.skipStreamParsing&&this.outlineListener(l.kF.DATA,_objectSpread({},t)):e.match(this.outlineRegEx)?(0,h.iJ)()?(this.streamResponseObject.parse(i),this.streamResponseObject.isComplete()&&(this.endOfStreamReceived=!0)):!i||void 0===i[0]||"heading"!==i[0].type&&"summary"!==i[0].type&&"doc_overview"!==i[0].type&&"doc_summary"!==i[0].type||!this.skipStreamParsing&&this.outlineListener(l.kF.DATA,i[0]):"end_of_stream.json"===e&&(this.endOfStreamReceived=!0,this.streamResponseObject.done(),!this.skipStreamParsing&&this.outlineListener(l.kF.DATA,{status:"COMPLETED"}))}else e===c.A.ERROR?!this.skipStreamParsing&&this.outlineListener(l.kF.UNZIP_STREAM_ERROR,t):e===c.A.END&&!this.skipStreamParsing&&this.outlineListener(l.kF.STREAM_ENDED,t)}ndJsonListener(e){this.skipStreamParsing&&this.outlineListener(e),this.streamResponseObject.parse(e);const t=this.streamResponseObject.getError(),n=Object.values(this.streamResponseObject.getPartErrors());if(t||n.length){this.aborted=!0;const e=(null==t?void 0:t.error_code)||n.length&&n[0].error_code||l.OQ.UNKNOWN;!this.skipStreamParsing&&this.outlineListener(l.kF.UNZIP_STREAM_ERROR,e)}this.streamResponseObject.isComplete()&&(this.endOfStreamReceived=!0,!this.skipStreamParsing&&this.outlineListener(l.kF.DATA,{status:"COMPLETED"}))}}var I,E,S=n("Qvga"),b=n("XEZ0");class CoreAPICache{constructor(){this.overviewAndSQsData={},this.ingestionData={},this.documentEligibilityData={}}setIngestionData(e,t,n){this.ingestionData[e]||(this.ingestionData[e]={}),this.ingestionData[e][t]=n}getIngestionData(e,t){return this.ingestionData[e][t]}setOverviewAndSQsData(e,t){this.overviewAndSQsData[e]||(this.overviewAndSQsData[e]=[]);const n=this.overviewAndSQsData[e].findIndex((e=>e.docId===t.docId));n>-1?this.overviewAndSQsData[e][n]=t:this.overviewAndSQsData[e].push(t)}getOverviewAndSQsData(e){return this.overviewAndSQsData[e]}setDocumentEligibilityData(e,t){this.documentEligibilityData[e]=t}getDocumentEligibilityData(e){return this.documentEligibilityData[e]}}!function(e){e.LAST_ACCESSED_TIME="lastAccessedTime"}(I||(I={})),function(e){e.OVERVIEW="OVERVIEW",e.ACCESS="ACCESS",e.QUESTION="QUESTION",e.ANSWERED_QUESTION="ANSWERED_QUESTION",e.RENAME="RENAME",e.ASSET_CHANGED="ASSET_CHANGED"}(E||(E={}));var A=n("/Blt"),GenAICoreAPIs_awaiter=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?o(e.value):function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(fulfilled,rejected)}step((i=i.apply(e,t||[])).next())}))};class GenAICoreAPIs{constructor(){var e=this;this.config={},this.ingestSingleAsset=function(t,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return GenAICoreAPIs_awaiter(e,[t,n,...o],void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){const{useCache:o=!0}=i,a=m.Xw.getClientID();let l;const c=(0,f.YP)(),{chunkListener:d,response:u}=createReadableStream();let h;"assetId"in e?h=e.assetId:(h=e.docId,l=e.buffer);const v={};if(o&&(null==t?void 0:t.session_id)){const e=n.coreAPICache.getIngestionData(null==t?void 0:t.session_id,h);if(e)return e}(null==i?void 0:i.skipClientDisqualification)||(yield n.isGenAIEligibleDocument(e).then((e=>{if(!(null==e?void 0:e.isEligible))return v.response=Promise.reject(new Error("Document not eligible")),v})).catch((e=>(v.response=Promise.reject(e),v))));const g=new(s()),P=(null==i?void 0:i.config)||{},I=new r.A({config:Object.assign(Object.assign({},n.config),P),featureName:"ingestion",clientId:a,abortController:g,requestInfoPromise:c,qnaResponseHandler:d,skipStreamParsing:!0}),{sessionInfoPromise:E,documentInfoPromise:S}=I.fetchKeyQuestions(e,l,null==i?void 0:i.clientAnalyticsConsent,null==i?void 0:i.documentMetadata,t,null==i?void 0:i.senseiInputParams);return v.response=Promise.resolve(u),v.documentInfoPromise=S,v.sessionInfoPromise=E,v.abortIngestDocuments=I.abortAPICalls.bind(I,!0),v.requestInfoPromise=c.promise,v.response.then((e=>GenAICoreAPIs_awaiter(n,void 0,void 0,(function*(){var t,n;const i=e.getReader(),o=yield E,s=o.sessionInfo.session_id,r=o.sessionInfo.doc_id;this.coreAPICache.setIngestionData(s,r,v);const a=new p.b;for(;;){const{done:e,value:t}=yield i.read();if(e)break;a.parse(t)}const l=a.getData(),c=null===(t=l.overview)||void 0===t?void 0:t.dataParts,d=Object.keys(c).map((e=>({data_id:e,text:c[e].parts.map((e=>e.text)).join(" ")})))[0],u=null===(n=l.key_questions)||void 0===n?void 0:n.dataParts,m=Object.keys(u).map((e=>({data_id:e,text:u[e].parts.map((e=>e.text)).join(" ")})));this.coreAPICache.setOverviewAndSQsData(s,{docId:r,overview:d,suggestedQuestions:m})})))),v}()}))},this.getIsDocumentEligibleForPromotion=(e,t,n)=>GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){var i,o,s,r,a,l;const c=(null===(i=null==n?void 0:n.docInfo)||void 0===i?void 0:i.Producer)||"",d=(null===(o=null==n?void 0:n.docInfo)||void 0===o?void 0:o.Creator)||"",u=null==n?void 0:n.numPages;if(u<3)throw new Error("PAGE_COUNT_NOT_SUPPORTED");if(null==n?void 0:n.hasAcroFormFields)throw new Error("ACRO_FORMS_NOT_SUPPORTED");if(null==n?void 0:n.isXFA)throw new Error("XFA_FIELDS_NOT_SUPPORTED");if((0,b.gR)(c,"Adobe XD"))throw new Error(`ADOBE_XD_FILE_NOT_SUPPORTED: flagged producer: ${c}`);if((0,b.D8)(d,"Acrobat PDFMaker","Visio"))throw new Error(`VISIO_FILE_NOT_SUPPORTED: flagged creator: ${d}`);if((0,b.kc)(d,["Microsoft® Visio","Microsoft® Office Visio","Microsoft Visio","Microsoft Office Visio"]))throw new Error(`VISIO_FILE_NOT_SUPPORTED: flagged creator: ${d}`);if((0,b.kc)(d,["Autodesk Investor","BlueBeam","Cairo Graphics","GuitarPro","FedEx Customer Automation","FedEx Services","AudienceView","Eventbrite","JasperReports Ticket"]))throw new Error(`DRAWINGS_NOT_SUPPORTED: flagged creator: ${d}`);if((0,b.kc)(d,["AutoCAD","ArchiCAD","ELCad","BricsCAD","CAXA CAD","ZWCAD","DataCAD","ARKEY CAD","OCAD","MegaCAD"],!1))throw new Error(`DRAWINGS_NOT_SUPPORTED: flagged creator: ${d}`);if("Canva"===d||(0,b.w1)(d,"Adobe Illustrator",!1)||(0,b.w1)(d,"CorelDRAW",!0)||(0,b.w1)(d,"Adobe Graphics Manager",!1))throw new Error(`DRAWINGS_NOT_SUPPORTED: flagged creator: ${d}`);for(let e=0;e<u;e+=1){const t=null==n?void 0:n.pages[e],[i,o,a,l]=(null===(s=null==t?void 0:t.boxes)||void 0===s?void 0:s.mediaBox)||[];if(void 0!==i&&void 0!==o&&void 0!==a&&void 0!==l){const n=(a-i)/72,s=(l-o)/72,c=Math.max(n,s)>17,d=Math.min(n,s)<4||Math.max(n,s)<6,u=!(Math.max(n,s)>0)||Math.min(n,s)/Math.max(n,s)<1/3;if(c||d||u)throw new Error(`PAGE_DIMENSIONS_NOT_SUPPORTED: page number: ${e+1}, \n                        media box: ${null===(r=null==t?void 0:t.boxes)||void 0===r?void 0:r.mediaBox}`)}}const m=["Movie","Sound","Screen","Widget","TrapNet","3D","Redact","RichMedia"],f=Math.min(u,5);for(let n=1;n<=f;n+=1){const i=yield e.getAnnots(t,{pageNum:n,annotsFilter:6160384}),o=(null===(a=null==i?void 0:i.data)||void 0===a?void 0:a.annots)||[];for(let e=0;e<o.length;e+=1){const t=(null===(l=o[e])||void 0===l?void 0:l.type)||"";if(m.includes(t))throw new Error(`ANNOTATION_NOT_SUPPORTED: flagged annotation: ${t}`)}}return!0})),this.isSufficientTextAvailable=(e,t,n)=>GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){const{MAX_PAGE_LIMIT:i,MIN_UNIQUE_CHAR_LIMIT:o,MIN_TOTAL_CHAR_LIMIT:s}=v.j,meetsCharacterCriteria=e=>{if(e.length<s)return!1;const t=new Set;for(const n of e)if(t.add(n),t.size>=o)return!0;return!1},hasSufficientText=(n,i)=>GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){var o;for(let s=n;s<=i;s+=1){const{data:n}=yield e.extractPageText(t,{pageNum:s,getWordRects:!0}),i=(null===(o=null==n?void 0:n.text)||void 0===o?void 0:o.paraNodes)||[];let r="";for(const e of i)if(r+=(null==e?void 0:e.contentDesc)||"",meetsCharacterCriteria(r))return!0}return!1}));return n<=i?hasSufficientText(1,n):!!(yield hasSufficientText(1,Math.floor(i/2)))||hasSufficientText(n-Math.floor(i/2)+1,n)})),this.scannedDocumentCheck=e=>GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){const{maxPageCount:t,maxFileSize:n,maxFileSizeInMb:i,supportedDocLanguages:o}=evaluateCurrentFeatureLimits(this.featureLimits,!0),s=m.Po.getLocale();if(!(null==o?void 0:o.includes(null==s?void 0:s.split("-")[0].toLowerCase())))throw new Error("SCANNED_DOCUMENT_NOT_SUPPORTED",{cause:{locale:s}});if(e.numPages>t)throw new Error("PAGE_LIMIT_EXCEEDED",{cause:{maxPageCount:t}});if(e.fileSize>1024*n)throw new Error("FILE_SIZE_LIMIT_EXCEEDED",{cause:{maxFileSize:n,maxFileSizeInMb:i}})})),this.documentLanguageCheck=(e,t)=>GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){if(!e||!t.includes(e.detectedLanguage)&&"un"!==e.detectedLanguage)throw new Error("DOC_LANG_NOT_SUPPORTED")})),this.getFeedbackAPIStatus=(e,t,n,i,o)=>{t?t.json().then((t=>{var s,r,a,l;const c=null===(r=null===(s=null==t?void 0:t.statuses[0])||void 0===s?void 0:s.invocations[0])||void 0===r?void 0:r.status;if("200"===c)n.emit("FeedbackAPISuccess",Object.assign({status:c},e)),i&&i(c);else{const i=(null===(l=null===(a=null==t?void 0:t.statuses[0])||void 0===a?void 0:a.invocations[0])||void 0===l?void 0:l.message)||"Unknown";n.emit("FeedbackAPIError",Object.assign({errorMessage:i},e)),o&&o(i)}})):o&&o("No response from feedback service")},this.sendFeedbackToService=(e,t,n,i)=>GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){const o=(yield(0,g.fl)("logging")).getLogger("feedbackAPI");this.feedbackAPIController.sendFeedbackToService(e,t,"beta"===this.config.genAIServiceVariant).then((t=>{this.getFeedbackAPIStatus({featureName:e.feature_name,feedbackType:"feedback"},t,o,n,i)})).catch((t=>{const n=t&&t.message?t.message:"Unknown";o.emit("FeedbackAPIError",{errorMessage:n,featureName:e.feature_name,feedbackType:"feedback"}),i&&i(n)}))})),this.sendRatingsToService=e=>GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){const t=(yield(0,g.fl)("logging")).getLogger("feedbackAPI");this.feedbackAPIController.sendRatingsToService(e).then((t=>{this.getFeedbackAPIStatus({featureName:e.featureName,feedbackType:"ratings"},t,e.apiSuccessCallback,e.apiErrorCallback)})).catch((n=>{const i=n&&n.message?n.message:"Unknown";t.emit("FeedbackAPIError",{errorMessage:i,featureName:e.featureName,feedbackType:"ratings"}),e.apiErrorCallback&&e.apiErrorCallback(i)}))})),this.transformQuestionAnswerDataToCHEvent=e=>{var t,n,i,o;const s=(0,A.g)(e),r=(null===(t=null==s?void 0:s.question_answer)||void 0===t?void 0:t.dataParts)||{},a=null===(n=Object.keys(r))||void 0===n?void 0:n.map((e=>{const t=r[e];return null==t?void 0:t.sources.map((e=>({docId:e.doc_id})))})).flat().filter(((e,t,n)=>t===n.findIndex((t=>t.docId===e.docId)))),l=null===(i=Object.keys(r))||void 0===i?void 0:i.map((e=>r[e].parts.map((e=>({id:e.part_id,text:e.text}))))).flat(),c=null===(o=Object.keys(r))||void 0===o?void 0:o.map((e=>r[e].sources.map((e=>({id:e.source_id,text:e.text,partId:e.part_id,asset:{docId:e.doc_id},bounds:e.bounds}))))).flat();return{eventId:"",eventType:E.ANSWERED_QUESTION,assets:a,answerParts:l,attributions:c}},this.featureLimits=null,this.feedbackAPIController=S.A,this.coreAPICache=new CoreAPICache,this.loggingPayloadCallback=()=>({})}ready(){return Promise.resolve(this)}configure(e){this.config=Object.assign(Object.assign({},this.config),e)}isGenAIEligibleDocument(e){return GenAICoreAPIs_awaiter(this,arguments,void 0,(function(e){var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function*(){var o,s,r;let a,l;const{useCache:c=!0}=n;if("assetId"in e){a=e.assetId;const{sourceName:t,assetId:n,connectorInfo:s,isACP:r}=e,c=yield i.webPlatform.locateImplementation("IStorage",t);l=yield null===(o=null==c?void 0:c.getAssetContent)||void 0===o?void 0:o.call(c,n,{connectorInfo:s,isACP:r})}else a=e.docId;if(c){const e=t.coreAPICache.getDocumentEligibilityData(a);if(e instanceof Error)throw e;if("boolean"==typeof(null==e?void 0:e.isEligible))return e}const d=yield i.providers.acrobatjs(),u=yield(0,g.fl)("logging").getLogger("fileDisqualificationAPI");let m=null;const f={},h=performance.now();try{const o={buffer:"buffer"in e?yield e.buffer:l};m=yield d.openPDF(o),f.openPdfTime=performance.now()-h;let c=performance.now();const{data:v}=yield d.getMetadata(m);f.metadataFetchTime=performance.now()-c;const g=(null===(s=null==v?void 0:v.docInfo)||void 0===s?void 0:s.Producer)||"Unknown",p=(null===(r=null==v?void 0:v.docInfo)||void 0===r?void 0:r.Creator)||"Unknown",P=yield i.webPlatform.locateImplementation("IGenAIProvisioningAPIs");P.configure({genAIServiceVariant:t.config.genAIServiceConfig}),t.featureLimits=yield P.getGenAIFeatureLimits();const I=evaluateCurrentFeatureLimits(t.featureLimits),E=I.maxPageCount,S=I.maxFileSize,A=I.maxFileSizeInMb,_=I.supportedDocLanguages;if(v.isPortfolio)throw new Error("PORTFOLIO_FILE_NOT_SUPPORTED");if(v.numPages>E)throw new Error("PAGE_LIMIT_EXCEEDED",{cause:{maxPageCount:E}});if(v.fileSize>1024*S)throw new Error("FILE_SIZE_LIMIT_EXCEEDED",{cause:{maxFileSize:S,maxFileSizeInMb:A}});if(!I.allowScannedPDFs){const e="Adobe Scan",t="with ClearScan",n="Paper Capture Plug-in";if((0,b.w1)(g,e)||(0,b.d5)(g,t)||(0,b.d5)(g,n))throw new Error("SCANNED_DOCUMENT_NOT_SUPPORTED")}c=performance.now();const{data:w}=yield d.isScannedDocument(m,{});f.scanStatusDetectionTime=performance.now()-c;const D=w&&"passed"===w.status&&w.isScannedDocument;if(v.isScannedDocument=D,D&&I.allowScannedPDFs&&t.scannedDocumentCheck(v),null==n?void 0:n.verifyDocEligibleForPromotion){c=performance.now();try{yield t.getIsDocumentEligibleForPromotion(d,m,v)}catch(e){throw f.promotionDisqualificationTime=performance.now()-c,e}f.promotionDisqualificationTime=performance.now()-c}if(!D){c=performance.now();const{data:e}=yield d.detectLanguage(m,{});e&&e.detectedLanguage,f.languageDetectionTime=performance.now()-c;try{yield t.documentLanguageCheck(e,_)}catch(e){throw e}}let y;if(!D&&(c=performance.now(),y=yield t.isSufficientTextAvailable(d,m,v.numPages),f.sufficientTextDetectionTime=performance.now()-c,!y&&!I.allowScannedPDFs))throw new Error("DISQUALIFIED_INSUFFICIENT_CONTENT");d.closePDF(m),f.totalTime=performance.now()-h,u.emit("FileDisqualificationAPI",f);const O={isEligible:!0,metadata:{isScannedDocument:D,numPages:v.numPages,producer:g,creator:p,isSufficientTextAvailable:y}};return t.coreAPICache.setDocumentEligibilityData(a,O),O}catch(e){let n=e;throw m&&d.closePDF(m),f.totalTime=performance.now()-h,u.emit("FileDisqualificationAPI",f),e&&"Incorrect password"===e.message&&(n=new Error("PASSWORD_PROTECTED_FILE_NOT_SUPPORTED")),t.coreAPICache.setDocumentEligibilityData(a,n),n}}()}))}fetchOverviewAndSQs(e){return this.coreAPICache.getOverviewAndSQsData(e)}setCallbackForGetEventsPayload(e){if("function"!=typeof e)throw new Error("Callback must be a function");this.loggingPayloadCallback=e}getEventsPayload(e,t){return this.loggingPayloadCallback(e,t)}ingestDocuments(e,t){return GenAICoreAPIs_awaiter(this,arguments,void 0,(function(e,t){var n=this;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function*(){if((null==e?void 0:e.length)<=0)throw new Error("Invalid Assets");const o=[];let s=0;if(!(null==t?void 0:t.session_id)){const r=e[0];o[0]=yield n.ingestSingleAsset(r,null,i);const a=yield o[0].sessionInfoPromise;t=a.sessionInfo,s++}for(let r=s;r<e.length;r++){const s=e[r];o[r]=yield n.ingestSingleAsset(s,t,i)}return o}()}))}fetchSummary(e,t,n){return GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){var i,o,s,r;let a;if(!e)throw new Error("Asset not provided");"assetId"in e||(a=e.buffer);const l=(0,f.YP)(),c=(0,f.YP)(),d=(0,f.YP)(),{chunkListener:u,response:m}=createReadableStream(),h=(null==n?void 0:n.config)||{},v=new GenAIOutlineController({config:Object.assign(Object.assign({},this.config),h),outlineListener:u,skipStreamParsing:!0,requestInfoPromise:l,sessionInfoPromise:c,documentInfoPromise:d});let g;if(v.fetchOutlineUnzippedStream(e,a,null==n?void 0:n.clientAnalyticsConsent,null==n?void 0:n.documentMetadata,t,null==n?void 0:n.maxRetryCount),!1===(null==n?void 0:n.useStreaming)){const e=(yield m).getReader(),t=new p.b;for(;;){const{done:n,value:i}=yield e.read();if(n)break;t.parse(i)}const n=t.getData();if(null==n?void 0:n.doc_summary){const e=null===(i=n.doc_summary)||void 0===i?void 0:i.dataParts;g={summary:Object.keys(e).map((t=>({data_id:t,text:e[t].parts.map((e=>e.text)).join(" ")})))[0]}}else{const e=null===(o=n.overview)||void 0===o?void 0:o.dataParts,t=null===(s=n.heading)||void 0===s?void 0:s.dataParts,i=null===(r=n.summary)||void 0===r?void 0:r.dataParts;g={overview:Object.keys(e).map((t=>({data_id:t,text:e[t].parts.map((e=>e.text)).join(" ")})))[0],heading:Object.keys(t).map((e=>({data_id:e,text:t[e].parts.map((e=>e.text)).join(" ")}))),summary:Object.keys(i).map((e=>({data_id:e,text:i[e].parts.map((e=>e.text)).join(" ")})))}}}else g=Promise.resolve(m);return{response:Promise.resolve(g),requestInfoPromise:l.promise,sessionInfoPromise:c.promise,documentInfoPromise:d.promise,abortFetchSummary:v.abortOutlineResponse.bind(v)}}))}fetchAnswer(e,t,n){return GenAICoreAPIs_awaiter(this,void 0,void 0,(function*(){let i;const o="string"==typeof e;if(o&&(i=e,!i||!(null==t?void 0:t.session_id)))throw new Error("Invalid input params");const s=(0,f.YP)(),a=(0,f.YP)(),{chunkListener:l,response:c,onError:d}=createReadableStream(),u=(null==n?void 0:n.config)||{},m=new r.A({config:Object.assign(Object.assign({},this.config),u),requestInfoPromise:s,sessionInfoPromise:a,qnaResponseHandler:l,skipStreamParsing:!0});return m.fetchAnswer(i,null==t?void 0:t.session_id,o?n:e).catch((e=>{d(e)})),{response:Promise.resolve(c),sessionInfoPromise:a.promise,requestInfoPromise:s.promise,abortFetchAnswer:m.abortAPICalls.bind(m,!0)}}))}fetchAlternateModels(){return new r.A({config:this.config}).fetchAlternateModels()}}const _=GenAICoreAPIs;GenAICoreAPIs.getInstance=i.providerUtil.getSingletonFunction(GenAICoreAPIs,!1)}}]);
//# sourceMappingURL=private/genAICoreAPIs-chunk.js.map